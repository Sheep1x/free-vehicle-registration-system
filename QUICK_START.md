# 快速开始指南

## 系统架构

免费车登记系统由两部分组成：

1. **微信小程序端** - 用于现场登记免费车辆信息
2. **后台管理系统** - 用于管理收费站、班组、人员和查看记录

---

## 第一步：配置后台管理系统

### 1. 运行配置脚本

```bash
./scripts/setup-admin.sh
```

这个脚本会自动从 `.env` 文件读取 Supabase 配置并更新后台管理系统。

### 2. 本地测试后台

```bash
cd admin
python3 -m http.server 8080
```

然后在浏览器访问：http://localhost:8080

### 3. 初始化基础数据

在后台管理系统中按以下顺序添加数据：

1. **添加收费站**
   - 进入"收费站管理"标签
   - 点击"添加收费站"
   - 填写收费站名称和编码
   - 示例：名称"京沪高速收费站"，编码"JSHG001"

2. **添加班组**
   - 进入"班组管理"标签
   - 点击"添加班组"
   - 选择所属收费站
   - 填写班组名称和编码
   - 示例：名称"一班"，编码"YB001"

3. **添加收费员**
   - 进入"收费员管理"标签
   - 点击"添加收费员"
   - 选择所属班组
   - 填写姓名和工号
   - 示例：姓名"张三"，工号"ZS001"

4. **添加监控员**
   - 进入"监控员管理"标签
   - 点击"添加监控员"
   - 选择所属收费站
   - 填写姓名和工号
   - 示例：姓名"李四"，工号"LS001"

5. **检查班次设置（可选）**
   - 进入"班次设置"标签
   - 查看默认的班次时间
   - 如需修改，点击"编辑"按钮
   - 默认设置：
     * 白班：7:30-15:30
     * 中班：15:30-23:30
     * 夜班：23:30-7:30

---

## 第二步：使用小程序

### 1. 开发模式

```bash
# 微信小程序
pnpm run dev:weapp

# H5预览
pnpm run dev:h5
```

### 2. 使用流程

1. **首页登记**
   - 点击"拍照"按钮调用摄像头
   - 或点击"选择图片"从相册选择
   - 等待AI自动识别车辆信息

2. **确认信息**
   - 检查识别结果
   - 选择免费原因（紧急车/军警车/应急车/旅游包车）
   - 从下拉列表选择收费员
   - 从下拉列表选择监控员
   - 查看自动显示的当前班次
   - 如需要，可手动编辑任何字段
   - 如识别不准确，点击"重新识别"

3. **保存记录**
   - 点击"保存记录"按钮
   - 系统自动保存到云端数据库
   - 跳转到历史记录页面

4. **查看历史**
   - 在"历史记录"标签查看所有记录
   - 使用搜索框按车牌号筛选
   - 点击记录查看详情
   - 长按记录进入编辑模式
   - 可批量删除记录

---

## 第三步：后台管理

### 1. 查看登记记录

- 进入"登记记录"标签
- 查看统计数据（总记录、今日、本月）
- 使用搜索框筛选记录
- 点击"查看"按钮查看详情
- 点击"删除"按钮删除记录

### 2. 导出数据

**导出Excel：**
- 点击"导出Excel"按钮
- 自动下载包含所有记录的Excel文件
- 文件名格式：`免费车登记记录_YYYY-MM-DD.xlsx`

**导出PDF：**
- 点击"导出PDF"按钮
- 自动下载PDF格式的记录
- 文件名格式：`免费车登记记录_YYYY-MM-DD.pdf`

### 3. 人员管理

**编辑人员信息：**
- 在对应的管理标签中找到人员
- 点击"编辑"按钮
- 修改信息后点击"确定"

**删除人员：**
- 点击"删除"按钮
- 确认删除操作
- 注意：删除收费站会同时删除其下属班组

---

## 常见问题

### Q1: 后台管理系统无法加载数据？

**解决方案：**
1. 检查 `admin/admin.js` 中的 Supabase 配置是否正确
2. 确认 `.env` 文件中的配置正确
3. 重新运行 `./scripts/setup-admin.sh`
4. 检查浏览器控制台是否有错误信息

### Q2: 小程序端无法选择收费员/监控员？

**解决方案：**
1. 确认后台已添加收费员和监控员
2. 检查网络连接
3. 重启小程序
4. 查看控制台是否有API错误

### Q3: 识别结果不准确？

**解决方案：**
1. 确保图片清晰，光线充足
2. 车辆信息文字清晰可见
3. 使用"重新识别"功能
4. 手动编辑修正识别结果

### Q4: 班次显示不正确？

**解决方案：**
1. 检查后台"班次设置"中的时间配置
2. 确认设备时间正确
3. 修改班次时间后重启小程序

### Q5: 如何部署后台管理系统？

**方案一：使用Vercel**
```bash
# 安装Vercel CLI
npm i -g vercel

# 部署admin文件夹
cd admin
vercel
```

**方案二：使用Netlify**
1. 登录 Netlify
2. 拖拽 `admin` 文件夹到部署区域
3. 获得在线访问地址

**方案三：传统服务器**
1. 将 `admin` 文件夹上传到Web服务器
2. 配置Nginx或Apache
3. 通过域名访问

---

## 数据备份建议

1. **定期导出数据**
   - 每周导出一次Excel文件
   - 保存到安全位置

2. **数据库备份**
   - 在Supabase控制台进行数据库备份
   - 设置自动备份计划

3. **配置文件备份**
   - 备份 `.env` 文件
   - 备份 `admin/admin.js` 配置

---

## 技术支持

如遇到问题，请检查：

1. **日志信息**
   - 浏览器控制台
   - 小程序调试器
   - Supabase日志

2. **文档资源**
   - [README.md](README.md) - 完整文档
   - [admin/README.md](admin/README.md) - 后台使用说明
   - [CHANGELOG.md](CHANGELOG.md) - 更新日志

3. **配置检查**
   - 确认所有环境变量正确
   - 检查数据库连接
   - 验证API密钥有效

---

## 下一步

系统配置完成后，您可以：

1. 自定义配色方案（修改 `src/app.scss`）
2. 调整班次时间（在后台管理系统中）
3. 添加更多收费站和人员
4. 开始使用小程序登记车辆
5. 定期查看和导出数据

祝使用愉快！🎉
