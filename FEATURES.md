# 功能特性详解

## 一、小程序端功能

### 1. 智能识别

#### 车辆信息识别
- **车牌号识别**：自动识别车牌颜色和完整号码
  - 支持颜色：蓝、黄、绿、白、黑
  - 格式：颜色 + 空格 + 号码（如：蓝 鲁P233CV）
  - 双重正则匹配，提高识别准确率

- **车型信息**：识别车辆类型（一型客车、二型货车等）

- **轴数和吨位**：自动提取车辆轴数和吨位信息

- **入口信息**：识别站点编号、路段名称、站点名称

- **通行时间**：提取完整的日期时间信息

- **金额信息**：识别通行费金额

#### AI技术
- 集成文心一言多模态大模型
- 实时流式识别
- 支持重新识别功能

### 2. 信息登记

#### 免费原因选择
- 紧急车
- 军警车
- 应急车
- 旅游包车

#### 人员信息
- **收费员选择**：从后台数据库下拉选择
  - 显示姓名和工号
  - 自动关联所属班组和收费站

- **监控员选择**：从后台数据库下拉选择
  - 显示姓名和工号
  - 自动关联所属收费站

#### 班次显示
- 自动识别当前班次（白班/中班/夜班）
- 根据后台设置的时间段判断
- 支持跨天班次（如夜班23:30-7:30）

#### 信息编辑
- 所有字段支持手动编辑
- 实时保存修改
- 左上角返回按钮

### 3. 历史记录

#### 记录查看
- 按时间倒序显示所有记录
- 卡片式布局，信息清晰
- 显示免费原因标签
- 显示收费员和监控员信息

#### 搜索筛选
- 按车牌号搜索
- 实时筛选结果

#### 详情查看
- 点击记录查看完整详情
- 显示所有识别信息
- 显示登记时间

#### 批量管理
- 长按进入编辑模式
- 多选记录
- 批量删除功能

### 4. 个人中心

- 使用说明
- 关于应用
- 版本信息

---

## 二、后台管理系统功能

### 1. 登记记录管理

#### 统计数据
- 总记录数
- 今日记录数
- 本月记录数

#### 记录查看
- 表格形式展示所有记录
- 显示完整车辆信息
- 显示免费原因、收费员、监控员
- 显示通行时间和登记时间

#### 搜索功能
- 按车牌号搜索
- 按免费原因搜索
- 按收费员搜索
- 按监控员搜索

#### 记录操作
- 查看详情
- 删除记录

#### 数据导出
- **Excel导出**
  - 包含所有字段
  - 支持中文
  - 自动命名（日期）
  
- **PDF导出**
  - 表格格式
  - 自动分页
  - 自动命名（日期）

### 2. 收费站管理

#### 基本功能
- 添加收费站
- 编辑收费站信息
- 删除收费站

#### 信息字段
- 收费站名称
- 收费站编码（唯一）
- 创建时间

#### 关联关系
- 一个收费站下属多个班组
- 删除收费站会同时删除其下属班组

### 3. 班组管理

#### 基本功能
- 添加班组
- 编辑班组信息
- 删除班组

#### 信息字段
- 班组名称
- 班组编码（唯一）
- 所属收费站
- 创建时间

#### 关联关系
- 班组归属于收费站
- 一个班组包含多个收费员

### 4. 收费员管理

#### 基本功能
- 添加收费员
- 编辑收费员信息
- 删除收费员

#### 信息字段
- 姓名
- 工号（唯一）
- 所属班组
- 创建时间

#### 显示信息
- 所属班组名称
- 所属收费站名称（通过班组关联）

### 5. 监控员管理

#### 基本功能
- 添加监控员
- 编辑监控员信息
- 删除监控员

#### 信息字段
- 姓名
- 工号（唯一）
- 所属收费站
- 创建时间

### 6. 班次设置

#### 默认班次
- **白班**：7:30-15:30
- **中班**：15:30-23:30
- **夜班**：23:30-7:30

#### 自定义设置
- 修改开始时间
- 修改结束时间
- 支持跨天设置

#### 自动识别
- 小程序端根据当前时间自动判断班次
- 实时更新
- 支持跨天班次逻辑

---

## 三、技术特性

### 1. 数据库设计

#### 表结构
- **toll_records**：登记记录表
- **toll_stations**：收费站表
- **toll_groups**：班组表
- **toll_collectors_info**：收费员信息表
- **monitors_info**：监控员信息表
- **shift_settings**：班次设置表

#### 关联关系
- 收费站 → 班组（一对多）
- 收费站 → 监控员（一对多）
- 班组 → 收费员（一对多）
- 班组 → 收费站（多对一）

#### 数据完整性
- 外键约束
- 级联删除
- 唯一性约束

### 2. 性能优化

#### 数据库索引
- 收费站ID索引
- 班组ID索引
- 工号唯一索引

#### 查询优化
- 关联查询优化
- 分页加载
- 缓存机制

### 3. 安全性

#### 数据访问
- Supabase安全连接
- API密钥保护
- 环境变量管理

#### 数据验证
- 前端表单验证
- 后端数据校验
- 唯一性检查

### 4. 用户体验

#### 响应式设计
- 小程序端移动优化
- 后台管理系统PC/移动自适应
- 流畅的动画效果

#### 交互反馈
- 加载状态提示
- 操作成功/失败提示
- 确认对话框

#### 错误处理
- 友好的错误提示
- 自动重试机制
- 日志记录

---

## 四、部署方案

### 1. 小程序端

#### 开发环境
```bash
pnpm run dev:weapp  # 微信小程序
pnpm run dev:h5     # H5预览
```

#### 生产环境
```bash
pnpm run build:weapp  # 构建微信小程序
```

### 2. 后台管理系统

#### 本地测试
```bash
cd admin
python3 -m http.server 8080
```

#### 云端部署
- Vercel
- Netlify
- 传统Web服务器
- 静态托管服务

---

## 五、扩展性

### 1. 可扩展功能

- 更多免费原因类型
- 更多车辆信息字段
- 图片管理功能
- 数据统计分析
- 报表生成
- 权限管理

### 2. 集成能力

- 第三方API集成
- 微信支付集成
- 短信通知
- 邮件通知
- 数据同步

### 3. 定制化

- 自定义配色方案
- 自定义字段
- 自定义工作流
- 自定义报表

---

## 六、维护支持

### 1. 日志系统

- 前端错误日志
- 后端操作日志
- 数据库查询日志

### 2. 监控告警

- 性能监控
- 错误监控
- 使用统计

### 3. 数据备份

- 自动备份
- 手动导出
- 版本控制

---

## 总结

免费车登记系统是一个功能完整、技术先进、易于使用的车辆登记管理解决方案。通过小程序端和后台管理系统的完美配合，实现了从现场登记到后台管理的全流程数字化。

**核心优势：**
- 🚀 智能识别，提高效率
- 📊 数据完整，便于管理
- 🔄 实时同步，云端存储
- 📱 移动优先，随时随地
- 🎨 界面美观，操作简单
- 🔒 数据安全，权限控制
- 📈 统计分析，导出便捷
- 🛠️ 易于部署，便于维护
