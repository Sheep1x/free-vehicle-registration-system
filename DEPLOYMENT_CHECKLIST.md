# 部署检查清单

## 📋 部署前检查

### 1. 环境配置 ✅

- [ ] 确认 `.env` 文件存在且配置正确
  ```bash
  cat .env | grep TARO_APP
  ```
  
- [ ] 验证 Supabase 连接
  - TARO_APP_SUPABASE_URL 正确
  - TARO_APP_SUPABASE_ANON_KEY 正确

### 2. 数据库准备 ✅

- [ ] 所有数据库迁移已执行
  ```bash
  ls supabase/migrations/
  ```
  应该看到：
  - 00001_create_toll_records_table.sql
  - 00002_add_free_vehicle_fields.sql
  - 00003_create_admin_management_tables.sql

- [ ] 数据库表已创建
  - toll_records
  - toll_stations
  - toll_groups
  - toll_collectors_info
  - monitors_info
  - shift_settings

### 3. 代码检查 ✅

- [ ] 运行代码检查
  ```bash
  pnpm run lint
  ```
  
- [ ] 确认无错误和警告

### 4. 后台管理系统配置 ✅

- [ ] 运行配置脚本
  ```bash
  ./scripts/setup-admin.sh
  ```
  
- [ ] 验证 admin/admin.js 中的配置已更新
  ```bash
  head -5 admin/admin.js
  ```

---

## 🚀 小程序端部署

### 开发环境测试

1. **启动开发服务器**
   ```bash
   pnpm run dev:weapp
   ```

2. **使用微信开发者工具**
   - 打开微信开发者工具
   - 导入项目目录
   - 选择 `dist` 文件夹
   - 测试所有功能

3. **功能测试清单**
   - [ ] 拍照功能正常
   - [ ] 图片选择功能正常
   - [ ] AI识别功能正常
   - [ ] 免费原因选择正常
   - [ ] 收费员下拉列表显示正常
   - [ ] 监控员下拉列表显示正常
   - [ ] 当前班次显示正常
   - [ ] 保存记录功能正常
   - [ ] 历史记录显示正常
   - [ ] 搜索功能正常
   - [ ] 查看详情功能正常
   - [ ] 删除记录功能正常

### 生产环境构建

1. **构建生产版本**
   ```bash
   pnpm run build:weapp
   ```

2. **上传到微信小程序平台**
   - 在微信开发者工具中点击"上传"
   - 填写版本号和备注
   - 提交审核

---

## 🖥️ 后台管理系统部署

### 方案一：本地测试

```bash
cd admin
python3 -m http.server 8080
```

访问：http://localhost:8080

### 方案二：Vercel 部署

1. **安装 Vercel CLI**
   ```bash
   npm i -g vercel
   ```

2. **部署**
   ```bash
   cd admin
   vercel
   ```

3. **获取部署URL**
   - Vercel 会提供一个在线访问地址
   - 记录这个地址供团队使用

### 方案三：Netlify 部署

1. **登录 Netlify**
   - 访问 https://app.netlify.com

2. **拖拽部署**
   - 将 `admin` 文件夹拖到部署区域
   - 等待部署完成

3. **获取部署URL**
   - Netlify 会提供一个在线访问地址

### 方案四：传统服务器

1. **上传文件**
   ```bash
   scp -r admin/ user@server:/var/www/html/
   ```

2. **配置 Nginx**
   ```nginx
   server {
       listen 80;
       server_name admin.yourdomain.com;
       root /var/www/html/admin;
       index index.html;
   }
   ```

3. **重启 Nginx**
   ```bash
   sudo systemctl restart nginx
   ```

---

## 🔧 后台管理系统初始化

### 1. 访问后台管理系统

打开浏览器，访问部署的后台管理系统URL

### 2. 添加基础数据

按以下顺序添加数据：

#### Step 1: 添加收费站
- 进入"收费站管理"标签
- 点击"添加收费站"
- 示例数据：
  ```
  名称：京沪高速收费站
  编码：JSHG001
  ```

#### Step 2: 添加班组
- 进入"班组管理"标签
- 点击"添加班组"
- 示例数据：
  ```
  名称：一班
  编码：YB001
  所属收费站：京沪高速收费站
  ```

#### Step 3: 添加收费员
- 进入"收费员管理"标签
- 点击"添加收费员"
- 示例数据：
  ```
  姓名：张三
  工号：ZS001
  所属班组：一班
  ```

#### Step 4: 添加监控员
- 进入"监控员管理"标签
- 点击"添加监控员"
- 示例数据：
  ```
  姓名：李四
  工号：LS001
  所属收费站：京沪高速收费站
  ```

#### Step 5: 检查班次设置
- 进入"班次设置"标签
- 确认默认时间是否符合需求
- 如需修改，点击"编辑"

### 3. 验证数据

- [ ] 收费站列表显示正常
- [ ] 班组列表显示正常，能看到所属收费站
- [ ] 收费员列表显示正常，能看到所属班组和收费站
- [ ] 监控员列表显示正常，能看到所属收费站
- [ ] 班次设置显示正常

---

## ✅ 功能验证

### 小程序端验证

1. **登记功能**
   - [ ] 拍照/选择图片
   - [ ] AI识别成功
   - [ ] 收费员下拉列表有数据
   - [ ] 监控员下拉列表有数据
   - [ ] 当前班次显示正确
   - [ ] 保存成功

2. **历史记录**
   - [ ] 记录显示正常
   - [ ] 搜索功能正常
   - [ ] 查看详情正常
   - [ ] 删除功能正常

### 后台管理系统验证

1. **记录管理**
   - [ ] 能看到小程序端提交的记录
   - [ ] 统计数据正确
   - [ ] 搜索功能正常
   - [ ] 导出Excel成功
   - [ ] 导出PDF成功

2. **人员管理**
   - [ ] 添加/编辑/删除收费站正常
   - [ ] 添加/编辑/删除班组正常
   - [ ] 添加/编辑/删除收费员正常
   - [ ] 添加/编辑/删除监控员正常
   - [ ] 编辑班次设置正常

---

## 📊 性能检查

- [ ] 小程序加载速度 < 3秒
- [ ] AI识别响应时间 < 10秒
- [ ] 后台管理系统加载速度 < 2秒
- [ ] 数据库查询响应时间 < 1秒

---

## 🔒 安全检查

- [ ] Supabase API密钥未泄露
- [ ] 后台管理系统访问控制（如需要）
- [ ] 数据库连接安全
- [ ] HTTPS配置（生产环境）

---

## 📝 文档检查

- [ ] README.md 完整
- [ ] QUICK_START.md 清晰
- [ ] admin/README.md 详细
- [ ] CHANGELOG.md 更新
- [ ] FEATURES.md 完整

---

## 🎯 用户培训

### 小程序端用户

1. **基本操作培训**
   - 如何拍照/选择图片
   - 如何选择免费原因
   - 如何选择收费员和监控员
   - 如何保存记录

2. **注意事项**
   - 确保图片清晰
   - 检查识别结果
   - 正确选择人员

### 后台管理员

1. **系统管理培训**
   - 如何添加收费站
   - 如何管理班组
   - 如何管理人员
   - 如何设置班次

2. **数据管理培训**
   - 如何查看记录
   - 如何搜索筛选
   - 如何导出数据
   - 如何备份数据

---

## 🔄 维护计划

### 日常维护

- [ ] 每日检查系统运行状态
- [ ] 每周导出数据备份
- [ ] 每月检查数据库性能

### 定期更新

- [ ] 更新依赖包
- [ ] 优化性能
- [ ] 修复bug
- [ ] 添加新功能

---

## 📞 技术支持

### 问题反馈渠道

- 技术文档：项目根目录下的 Markdown 文件
- 日志查看：浏览器控制台 / 小程序调试器
- 数据库监控：Supabase 控制台

### 常见问题解决

参考 QUICK_START.md 中的"常见问题"部分

---

## ✨ 部署完成

当所有检查项都完成后，系统即可正式投入使用！

**祝贺！免费车登记系统部署成功！** 🎉

---

## 📅 部署记录

- 部署日期：__________
- 部署人员：__________
- 小程序版本：__________
- 后台URL：__________
- 备注：__________
